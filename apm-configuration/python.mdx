---
title: "Python"
---
<a target="_blank" href="https://pypi.org/project/middleware-apm/">
    <span style={{
        background: "url(https://img.shields.io/pypi/v/middleware-apm) no-repeat",
        width: "125px",
        height: "20px",
        display: "inline-block",
    }}/>
</a>

| Traces | Metrics | App Logs | Custom Logs | Profiling |
| :----: | :-----: | :------: | :---------: | :-------: |
| ✅ | ✅ | ✅ | ✅ | ✅ |

This guide walks you through setting up Application Performance Monitoring (APM) on a Python application. These instructions can also be found on the Installation page in your Middleware Account. View example code <a href="https://github.com/middleware-labs/demo-apm/tree/master/python"> here </a>.


# Prerequisites

<Steps>

  <Step title="MW Host Agent">
   Middleware Host Agent (MW Agent). To install the MW Agent, see our <a href="https://docs.middleware.io/docs/agent-installation/overview"> installation guide</a>. 
  
  </Step>

  <Step title="Python Version">
   `Python 3 version 3.8` or above. Check your Python version with the following command:
    ```bash Shell
    python3 --version
    ```
  </Step>

  <Step title="Pip Version">
    `pip version 23.1.2` or above. Check your pip version with the following command:
    ```bash Shell
    pip --version
    ```  
  </Step>

</Steps>



# Install

<Accordion title="Step 1: Install Middleware Python APM Package"> 
Run the following command in your terminal:
```python Shell
pip install middleware-apm
```
</Accordion>

<Accordion title="Step 2: Import Middleware Tracker"> 

Add the following lines to the beginning of your application:

```python Python 3
import logging 
 
from middleware import MwTracker
tracker=MwTracker()
```
</Accordion>

<Accordion title="Step 3: Container Variables (Optional)"> 
Applications running in a container require an additional environment variable. If your application is not running in a container, move to Step 4. 

For Docker containers, add the following environment variable to your application:
```bash Shell
MW_AGENT_SERVICE=<DOCKER_BRIDGE_GATEWAY_ADDRESS>
```
<Note> docker bridge gateway address is the IP address of the gateway between the Docker host and the bridge network, which is 172.17.0.1 by default. 
Refer more about Docker bridge networking [here](https://docs.docker.com/network/network-tutorial-standalone/) </Note>

For Kubernetes, first identify the namespace where the MW Agent is running:

```bash Shell
kubectl get service --all-namespaces | grep mw-service
```

Then add the following environment variable to your application deployment YAML file:
```bash Shell
MW_AGENT_SERVICE=mw-service.mw-agent-ns.svc.cluster.local
```
</Accordion>

<Accordion title="Step 4: Capture Application Data"> 
    <AccordionGroup>
        <Accordion title="Setup .ini File"> 

            Create a `.ini` file based on the features you want to observe. `service_name` and `access_token` are required for the tracker to send data to Middleware.

            ```python .ini
            [middleware.common]

            # The name of your application as service-name, as it will appear in the UI to filter out your data.
            service_name = {APM-SERVICE-NAME}

            # This Token binds the Python Agent's data and profiling data to your account.
            access_token = {YOUR-ACCESS-TOKEN}

            # The service name, where Middleware Agent is running, in case of K8s.
            mw_agent_service = mw-service.mw-agent-ns.svc.cluster.local

            # Distributed traces for your application (false = disabled).
            collect_traces = true

            # Collection of metrics for your application (false = disabled).
            collect_metrics = true

            # Collection of logs for your application (false = disabled).
            collect_logs = true

            # Collection of profiling data for your application (false = disabled).
            collect_profiling = true
            ```
        </Accordion>

        <Accordion title="Enable Custom Logs"> 

            To ingest custom logs, utilize the following functions based on desired log severity levels:

            ```python Python 3
            logging.info("info sample")
            logging.warning("Sample Warning Log") 
            logging.error("Sample Error Log.", extra={'tester': 'Alex'})
            ```
        </Accordion>

        <Accordion title="Stack Errors"> 
            
            Use `tracker.record_error()` method to record a stack trace when an error occurs:

            ```python Python 3
            try:
                not_possible = 12/0
            except ZeroDivisionError as e:
                tracker.record_error(e)
            ```
        </Accordion>
    </AccordionGroup>
</Accordion>

<Accordion title="Step 5: Start Your Project">

After deploying your application, run the following command to start your project:
```shell Shell
MIDDLEWARE_CONFIG_FILE=./middleware.ini middleware-apm run python app.py
```
</Accordion>

# Continuous Profiling

Continuous profiling captures real-time performance insights from your application to enable rapid identification of resource allocation, bottlenecks, and more. The following table describes the available features offered by the continuous profiler for the Python APM.

For more information on Continuous Profiling, navigate to [Workflows](/workflow/profiling) to find out more.

|     |     |     |     |    |      |     |
| :-: | :-: | :-: | :-: |:-: | :-: | :-: |
|  __Object Allocation__   |   __Memory Allocation__  |   __Objects in Use__  |  __Memory in Use__   |  __CPU Usage__  | __Wall-clock time__ | __Reference__ |
|        ✖️                  |    ✖️                      |      ✖️                 |        ✖️              |         ✅      |        ✖️             |          ✖️     |

<Note> Need assistance or want to learn more about Middleware? Contact us at support[at]middleware.io. </Note>

