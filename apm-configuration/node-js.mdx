---
title: "Node.js"
---
<a target="_blank" href="https://www.npmjs.com/package/@middleware.io/node-apm">
    <span style={{
        background: "url(https://img.shields.io/npm/v/%40middleware.io%2Fnode-apm) no-repeat",
        width: "125px",
        height: "20px",
        display: "inline-block",
    }}/>
</a>

| Traces | Metrics | App Logs | Custom Logs | Profiling |
| :----: | :-----: | :------: | :---------: | :-------: |
| ✅ | ✖️ | ✖️ | ✅ | ✅ |

This guide walks you through setting up Application Performance Monitoring (APM) on a Node.js application. These instructions can also be found on the Installation page in your Middleware Account. View <a href="https://github.com/middleware-labs/demo-apm/tree/master/nodejs"> demo project here </a>.

# Prerequisites

<Steps>

  <Step title="MW Host Agent">
   The Middleware Host Agent (MW Agent). To install the MW Agent please see our <a href="https://docs.middleware.io/docs/agent-installation/overview"> installation guides </a>. 
  
  </Step>

  <Step title="Node.js Version">
   `Node.js version 18.17.1` or above. Check your Node.js version with the following command:
    ``` javascript bash
    node --version
    ```

  </Step>

</Steps>

# Install

<Accordion title="Step 1: Install NPM Package">

Run the following command in your terminal. 

```javascript bash
npm install @middleware.io/node-apm --save
```
</Accordion>

<Accordion title="Step 2:  Initialize Tracker">

Add the following lines to the beginning of your application code base. The access token is your account key, which can be found on the Installation page.

```javascript Node.js
const tracker = require('@middleware.io/node-apm');
tracker.track({
    projectName: "your-project-name",
    serviceName: "your-service-name",
    accessToken: “<xxxxxxxxxx>”;
});
```
</Accordion>

<Accordion title="Step 3: Container Variables">

Applications running in a container require an additional environment variable. If your application is not running in a container, move to Step 4. 

For Docker containers, add the following environment variable to your application.
```javascript bash
MW_AGENT_SERVICE=<DOCKER_BRIDGE_GATEWAY_ADDRESS>
```
<Note> docker bridge gateway address is the IP address of the gateway between the Docker host and the bridge network, which is 172.17.0.1 by default. 
Refer more about Docker bridge networking [here](https://docs.docker.com/network/network-tutorial-standalone/) </Note>

```javascript bash
kubectl get service --all-namespaces | grep mw-service
```

Then add the following environment variable to your application deployment YAML file. 
```javascript bash
MW_AGENT_SERVICE=mw-service.mw-agent-ns.svc.cluster.local
```
</Accordion>

<Accordion title="Step 4: Capture Application Data">
    <AccordionGroup>
        <Accordion title="Traces">
            
            Distributed tracing is automatically enabled upon completion of Step 2.
        </Accordion>

        <Accordion title="Custom Logs">
            
            To ingest custom logs into Middleware, utilize the following functions inside your logging method based on desired log severity levels.
            ```javascript Node.js
            tracker.info('Info sample');
            tracker.warn('Warning sample');
            tracker.debug('Debugging Sample');
            tracker.error('Error Sample');
            ```

            To add stack traces along with the error log, use the following error tracking function.
            ```javascript Node.js
            tracker.error(new Error('Error sample with stack trace'));
            ```
        </Accordion>

        <Accordion title="Profiling">            
            Application Profiling is auto-configured upon completing Step 2.
        </Accordion>

        <Accordion title="Stack Traces ">  
            
            Use the errorRecord method to record a stack trace when an error occurs. See an example of this method below. 
            ```javascript Node.js 
            app.get('/error', function (req, res) {
                try{
                    throw new Error('oh error!');
                }catch (e) {
                track.errorRecord(e)
                }
                res.status(500).send("wrong");
            }); 
            ```
        </Accordion>
    </AccordionGroup>
</Accordion>

# Continuous Profiling

Continuous profiling captures real-time performance insights from your application to enable rapid identification of resource allocation, bottlenecks, and more. The following table describes the available features offered by the continuous profiler for the Node.js APM.

For more information on Continuous Profiling, navigate to [Workflows](/workflow/profiling) to find out more.

|     |     |     |     |    |      |     |
| :-: | :-: | :-: | :-: |:-: | :-: | :-: |
|  __Object Allocation__   |   __Memory Allocation__  |   __Objects in Use__  |  __Memory in Use__   |  __CPU Usage__  | __Wall-clock time__ | __Reference__ |
|          ✖️                |        ✖️                  |           ✅          |       ✅             |       ✖️          |        ✖️             |      ✖️         |

<Note> Need assistance or want to learn more about Middleware? Contact us at support[at]middleware.io. </Note>
