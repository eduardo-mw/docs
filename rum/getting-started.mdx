---
title: Installing RUM
sidebarTitle: "RUM"
---

Middleware Real User Monitoring (RUM) provides insights into your application or website through detailed data on user interactions and frontend performance. With real-time data on page load times, errors, and more you can quickly identify and resolve performance issues to improve user experience and engagement. Check out the video below for more information.

<Warning> If you are installing RUM in `Next.js`, you will not have a template HTML file. Once you have completed the Installation steps, move to the [Troubleshooting](/rum/getting-started#troubleshooting) section and click on __Next.js - Installing Without an index.html File__ </Warning>

<a href="https://www.loom.com/share/ed0f136a6dd7436ba951356c936e0ca3" target="_blank">
  <img height="200" noZoom src="/images/rum_0.png" />
</a>

# Install
This guide walks you through setting up Real User Monitoring (RUM) with JavaScript. These instructions can also be found on the Installation page in your Middleware Account.

<AccordionGroup>
    <Accordion title="Step 1: Create Application Reference">
        Navigate to the Installation page in your Middleware Account. In the Real User Monitoring section, select `Create New Application` and provide the application name, origin(s) and Trace Propogation Target(s) to whitelist. Multiple origins can be listed as a comma-separated list.
    </Accordion>

    <Accordion title="Step 2: Import Javascript CDN">
        Add the following script tag to the head section of your index.html file. The tag can be copied directly from the Installation page upon completing Step 1.
        ```javascript HTML
        <script src="https://cdnjs.middleware.io/browser/libs/0.0.1/middleware-rum.min.js" type="text/javascript"></script>
        ```
    </Accordion>

    <Accordion title="Step 3: Initialize the SDK">
        Add the following lines in your index.html file below the script tag entered in Step 2. We recommend copying directly from the Installation page; select the appropriate Application from the list and copy the code snippet. The `window.Middleware` attribute is set in the script from Step 2. 

        In the example below, env and recording are optional. Recording set to 1 is the default value and records the entire user session. To track only browser traces and errors set recording to 0.

        ```javascript JavaScript
        <script>
            if (window.Middleware){
                Middleware.track({
                    serviceName: "service_name",
                    accountKey: "account_key",
                    target:"https://<UID>.middleware.io",
                    env: "production",
                    recording: "1"
                })
            }
        </script>
        ```
    </Accordion>

    <Accordion title="Step 4: Add User Information [optional]">
        To gather user details add key-value pairs, as shown below. Any user metadata can be defined as a key-value pair.

        ```javascript JavaScript
        if(window.Middleware){
        ...
        defaultAttributes: { 
            name: 'John Doe', 
            email: 'john@email.com', 
            user_type: 'admin', // it can be key value pairs
        }
        }
        ```
        If you need to define attributes post initialization of the SDK, utilize the 'Middleware.setAttributes' method, as exemplified in the following example.

        ```javascript JavaScript
        <script>
        if(window.Middleware){
                Middleware.setAttributes({
                    name: 'John Doe',
                    email: 'john@email.com',
                    user_type: 'admin',
                })
            }
        </script>
        ```
        Once RUM is configured, metrics should begin appearing on the RUM Dashboard in Middleware within a few minutes. For more information on the RUM Dashboards see [here](https://docs.middleware.io/docs/rum/rum-middleware).
    </Accordion>

    <Accordion title="Step 5: Add Custom Logs [optional]">
        Use these functions to keep track of different types of issues in your system, making it easier to monitor and fix problems.

        ```javascript JavaScript
        <script>
        if(window.Middleware){
            Middleware.error("Your error message")
            Middleware.error(new Error("Your error message"))
            Middleware.info("info message")
            Middleware.warn("warn message")
            Middleware.debug("debug message")
            }
        </script>
        ```
    </Accordion>
</AccordionGroup>

# Connect RUM to Tracing

RUM Tracing allows you to gain insight into the specific actions of your users. You can watch time-stamped videos of user's website interactions, pinpoint performance bottlenecks across your platform, and identify the major causes of customer drop off.

The following installation uses OpenTelemetry B3 Propagator heads. Learn more about B3 Propagation [here](https://github.com/openzipkin/b3-propagation).

<Note> You must have a Middleware APM Agent installed in order to use the tracing feature. Install a Middleware APM [here](/apm-configuration/apm_overview). </Note>

<AccordionGroup>
    <Accordion title="Step 1: Modify Middleware SDK">
        Add `tracePropagationTargets` to your SDK from [Step 3](#step-3-initialize-the-sdk) of the RUM Installation. The `tracePropagationTargets` value must be in regex format.

        <Warning> The Middleware JavaScript client is by default configured with `b3` headers. You can change your headers by adding `tracePropagationFormat` to change the headers to `w3c` or `all`. </Warning>

        ```javascript JavaScript
        <script>
            if (window.Middleware){
                Middleware.track({
                    serviceName: "service_name",
                    accountKey: "account_key",
                    target: "https://<UID>.middleware.io",
                    env: "production",
                    recording: "1",
                    tracePropagationTargets: [/localhost:3000/i, /api.domain.com/i],
                    tracePropagationFormat: "w3c"
                })
            }
        </script>
        ```
    </Accordion>

    <Accordion title="Step 2: Modify APM SDK">
        In order to enable Trace Propagation, some languages require the `OTEL_PROPAGATORS=b3` environment variable. Those languages are called out in the table below. All other langugages will work with the standard APM install.
    </Accordion>
</AccordionGroup>

# Access RUM From Trace List

To access your Session Replay data, navigate to the APM section, select the Trace List tab and choose a trace to view your data.

<Note> For more information about using RUM, head to the [RUM Workflow page](/workflow/using-rum). </Note>

<img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNnRxNzFmajVnYXZpZW8xbGR6OHF3NjZ6aWozYXRjZmZ5OHlnc3c4eCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/AQhJ5ezOms5ncTNH7a/giphy.gif" width="900" height="900" />

# Supported APMs
|       | | | |
| :----:| :--:|:--:| :--:|
| **Language**                                |    **Supported**   | **APM Version** | **Environment Variable** |
| [Cloudflare](/apm-configuration/cloudflare) |           ✖️        |   ✖️             |        ✖️             |
| [Go](/apm-configuration/go)           |                ✅        |   `>= 1.1.100`     |        ✖️             |
| [Java](/apm-configuration/java)         |              ✅        |    ✖️            |         ✅               | 
| [.NET](/apm-configuration/dotnet)       |              ✅        |     ✖️           |       ✅                 |
| [Next.js](/apm-configuration/next-js)      |           ✅        |     ✖️           |            ✖️             |
| [Node.js](/apm-configuration/node-js)      |           ✅        | `>= 1.2.5`         |            ✖️             |
| [PHP](/apm-configuration/php)          |                ✖️        |    ✖️            |            ✖️             |
| [Python](/apm-configuration/python)       |            ✅        | `>= 0.3.2`         |            ✖️             |
| [Ruby](/apm-configuration/ruby)         |              ✅        | `>= 2.1.0`         |   ✅  |
| [Vercel](/apm-configuration/vercel-integration)   |     ✅        |    ✖️            |            ✖️             |

# Troubleshooting

<Accordion title="Next.js - Installing Without an index.html File">
    When using Next.js, you do not have direct access to the `index.html` or template HTML file. You must define the structure of your RUM application with one of the following methods:

    <Accordion title="App Router">
        Define the structure of your application with app routers.

        <Note> Click [here](https://nextjs.org/docs/app/building-your-application/optimizing/third-party-libraries) for more information on integrating third party libraries with Next.js using app structure. </Note>
        
        Apply the following script to your application code:

        ```javascript Next.js
        import Script from "next/script"

        export default function RootLayout({
        children,
        }: {
        children: React.ReactNode
        }) {
        
        return (
            <html lang="en">
            <head>
                <Script
                strategy="beforeInteractive"
                id="middleware-lib-init"
                src="https://cdnjs.middleware.io/browser/libs/0.0.1/stage/middleware-rum.min.js"
                type="text/javascript"
                />
                <Script
                strategy="beforeInteractive"
                id="middleware-script-init">
                {
                    `
                    if (window.Middleware){
                        window.Middleware.track({
                        serviceName: "name",
                        projectName: "name",
                        accountKey: "<REDACTED>",
                        target: "https://name.middleware.io",
                        tracePropagationTargets: [/localhost:3000/i]
                        });
                    }
                    `
                }
                </Script>
            </head>
            <body>
                {children}
            </body>
            </html>
        )
        }
        ```
    </Accordion>

    <Accordion title="Page Router">
        Define the structure of your application with page structure.

        <Note> Click [here](https://nextjs.org/docs/pages/building-your-application/optimizing/scripts) for more information on integrating third party libraries with Next.js using page structure. </Note>
    
        Apply the following script to your application code:
        ```javascript Next.js
        import Script from 'next/script'
        
        export default function MyApp({ Component, pageProps }) {
        return (
            <>
            <Component {...pageProps} />
            <Script
                strategy="beforeInteractive"
                id="middleware-lib-init"
                src="https://cdnjs.middleware.io/browser/libs/0.0.1/stage/middleware-rum.min.js"
                type="text/javascript"
                />
                <Script
                strategy="beforeInteractive"
                id="middleware-script-init">
                {
                    `
                    if (window.Middleware){
                        window.Middleware.track({
                        serviceName: "name",
                        projectName: "name",
                        accountKey: "<REDACTED>",
                        target: "https://name.middleware.io",
                        tracePropagationTargets: [/localhost:3000/i]
                        });
                    }
                    `
                }
                </Script>
            </>
        )
        }
        ```

    </Accordion>    
</Accordion>

<Accordion title="Browser Cookies">
    The RUM Browser SDK uses cookies to remember a single user session across different pages on your website. These are first-party cookies and stay within your domain; they won't be used to track users across different sites.

    |   |   |
    |:-:|:-|
    |__Cookie Name__     | __Details__ |
    |`_mwRumSessionId_x` | This cookie collects all the actions from a user's visit across different pages. This cookie includes the current session ID, whether the session has been excluded as a result of sampling, and the session expiration date. Each time a user interacts with the website, an extra 15 minutes is added to the cookie's timer, ensuring the session remains active, with a maximum duration of 4 hours.

</Accordion>

<Accordion title="Script Integration Issues">
    If you are experiencing exceptions and errors while integrating the RUM browser SDK, consider moving Middleware packages and scripts earlier in the execution of your application code to avoid collisions with your website's code.
    
    Make sure you have added the following Middleware script with the `setTimeout` function:

    ```javascript JavaScript
    setTimeout(() => {
        if(window.Middleware) {
            Middleware.track({
                serviceName: "sample-service",
                projectName: "sample-project",
                accountKey: "REDACTED",
                target: "<target-url>"
            })
        }
    }, 10000)
    ```
</Accordion>

<Accordion title="Unable to See Session Recording">
    Check if the origin URL (from where the session recording takes place) is correct. 

    Check your network tab in your developer console if any adblockers or extensions are stopping Middleware requests.
</Accordion>

<Accordion title="Unhandled Promise Rejection: TypeError: Failed to fetch">
    This error can be ignored, as it does not impact the Middleware RUM Browser SDK. This issue commonly occurs when an API call is being executed and a user refreshes the page. 
</Accordion>

<Note> Need assistance or want to learn more about Middleware? Contact us at support[at]middleware.io. </Note>
