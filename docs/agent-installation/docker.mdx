This guide walks you through installing the MW Agent on a machine deployed through Docker. These instructions can also be found on the Installation page in the Middleware application. 

The Docker MW Agent is a containerized version of the MW Agent. Upon installation, the MW Agent collects host level details from host network mode and uses volume binding for reading logs.

## Overview
### Prerequisites

-   Docker version TBD

-   Any operating system meeting our version requirements:

    -   Ubuntu TBD
    
    -   Amazon Linux TBD
    
    -   Red Hat TBD
    
    -   Debian TBD
    
    -   MacOS TBD

## Install
Follow the steps below to install the MW Agent on your machine deployed through Docker.

1.  Log in to Middleware

2.  Navigate to the installation page, in the bottom left corner
 <img src="/images/agent-installation/k1.png" />

3. Copy and run the installation command. An example of the command is shown below. Copying the command directly from the Installation page ensures your API key and UID are accurately inputted. 
```bash
MW_API_KEY=<xxxxxxxxxx> TARGET=https://<uid>.middleware.io:443 bash -c “$(curl -L https://install.middleware.io/scripts/docker-install.sh)
```

 <img src="/images/agent-installation/k6.jpg" />

4.[optional] Add tags by adding the MW_HOST_TAGS environment variable to the installation command. Include any desired tags as comma-separated key-value pairs, as shown below. Use the tag “name” to create an alias for the host (e.g. production). 
```bash
MW_HOST_TAGS=<key1>:<value1>,<key2>:<value2>,… MW_API_KEY=…
```

5. Verify the status of the MW Agent with the following command.
```bash
docker ps -a --filter ancestor=ghcr.io/middleware-labs/mw-host-agent:master
```
A successful installation returns the status ‘Up’ or ‘Exited’. If the installation is unsuccessful the status will be blank. 
 <img src="/images/agent-installation/k6.jpg" />

6. Navigate to Middleware and ensure metrics are appearing in the Unified Dashboard. It can take up to a few minutes for metrics to appear. If metrics do not appear after this time head to our troubleshooting page for some common issues.

<Warning>  Run only one MW Agent. Multiple agents will cause unexpected behavior. </Warning>

## Troubleshooting
Once the MW Agent is installed metrics should begin appearing in the Middleware application within a few minutes. If metrics do not appear, confirm that the machine has access to the internet, either directly or through a proxy, and that only one (1) MW Agent container is running. 

For any issues please reach out to our team in your Slack channel or through the help menu in the Middleware Application.

## Uninstall
To uninstall the Middleware Agent use the following commands.
```bash
docker stop `docker ps -a -q --filter ancestor=ghcr.io/middleware-labs/mw-host-agent:master`
docker rm `docker ps -a -q --filter ancestor=ghcr.io/middleware-labs/mw-host-agent:master`
```



