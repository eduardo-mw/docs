---
title: "Node.js"
---
<a target="_blank" href="https://www.npmjs.com/package/@middleware.io/node-apm">
    <span style={{
        background: "url(https://img.shields.io/npm/v/%40middleware.io%2Fnode-apm) no-repeat",
        width: "125px",
        height: "20px",
        display: "inline-block",
    }}/>
</a>

<table border="1" style={{margin: "10px 0", textAlign: "center"}}>
    <thead>
    <tr>
        <th style={{padding:"8px 15px"}}>Traces</th>
        <th style={{padding:"8px 15px"}}>Metrics</th>
        <th style={{padding:"8px 15px"}}>App Logs</th>
        <th style={{padding:"8px 15px"}}>Custom Logs</th>
        <th style={{padding:"8px 15px"}}>Profiling</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td><span style={{
            background: "url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkiIGhlaWdodD0iMTkiIHZpZXdCb3g9IjAgMCAxOSAxOSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTkuNDI2NTcgMTguNjA4QzQuMzUyNDIgMTguNjA4IDAuMjQxNDU1IDE0LjQ5NyAwLjI0MTQ1NSA5LjQyMjg1QzAuMjQxNDU1IDQuMzQ4NjkgNC4zNTI0MiAwLjIzNzczMiA5LjQyNjU3IDAuMjM3NzMyQzE0LjUwMDcgMC4yMzc3MzIgMTguNjExNyA0LjM0ODY5IDE4LjYxMTcgOS40MjI4NUMxOC42MTE3IDE0LjQ5NyAxNC41MDA3IDE4LjYwOCA5LjQyNjU3IDE4LjYwOFoiIGZpbGw9IiMyREE0NEUiLz4KPHBhdGggZD0iTTguMjU0OCAxMi4wNDQzTDUuNDU0NTkgOS4yNDQxNCIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIxLjMxMjE2IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPHBhdGggZD0iTTEzLjg1NTEgNi40NDM5MUw4LjI1NDY0IDEyLjA0NDMiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMS4zMTIxNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cjwvc3ZnPgo=) no-repeat",
            width: "20px",
            height: "20px",
            display: "inline-block",
        }}/></td>
        <td>-</td>
        <td>-</td>
        <td><span style={{
            background: "url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkiIGhlaWdodD0iMTkiIHZpZXdCb3g9IjAgMCAxOSAxOSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTkuNDI2NTcgMTguNjA4QzQuMzUyNDIgMTguNjA4IDAuMjQxNDU1IDE0LjQ5NyAwLjI0MTQ1NSA5LjQyMjg1QzAuMjQxNDU1IDQuMzQ4NjkgNC4zNTI0MiAwLjIzNzczMiA5LjQyNjU3IDAuMjM3NzMyQzE0LjUwMDcgMC4yMzc3MzIgMTguNjExNyA0LjM0ODY5IDE4LjYxMTcgOS40MjI4NUMxOC42MTE3IDE0LjQ5NyAxNC41MDA3IDE4LjYwOCA5LjQyNjU3IDE4LjYwOFoiIGZpbGw9IiMyREE0NEUiLz4KPHBhdGggZD0iTTguMjU0OCAxMi4wNDQzTDUuNDU0NTkgOS4yNDQxNCIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIxLjMxMjE2IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPHBhdGggZD0iTTEzLjg1NTEgNi40NDM5MUw4LjI1NDY0IDEyLjA0NDMiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMS4zMTIxNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cjwvc3ZnPgo=) no-repeat",
            width: "20px",
            height: "20px",
            display: "inline-block",
        }}/></td>
        <td><span style={{
            background: "url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkiIGhlaWdodD0iMTkiIHZpZXdCb3g9IjAgMCAxOSAxOSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTkuNDI2NTcgMTguNjA4QzQuMzUyNDIgMTguNjA4IDAuMjQxNDU1IDE0LjQ5NyAwLjI0MTQ1NSA5LjQyMjg1QzAuMjQxNDU1IDQuMzQ4NjkgNC4zNTI0MiAwLjIzNzczMiA5LjQyNjU3IDAuMjM3NzMyQzE0LjUwMDcgMC4yMzc3MzIgMTguNjExNyA0LjM0ODY5IDE4LjYxMTcgOS40MjI4NUMxOC42MTE3IDE0LjQ5NyAxNC41MDA3IDE4LjYwOCA5LjQyNjU3IDE4LjYwOFoiIGZpbGw9IiMyREE0NEUiLz4KPHBhdGggZD0iTTguMjU0OCAxMi4wNDQzTDUuNDU0NTkgOS4yNDQxNCIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIxLjMxMjE2IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPHBhdGggZD0iTTEzLjg1NTEgNi40NDM5MUw4LjI1NDY0IDEyLjA0NDMiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMS4zMTIxNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cjwvc3ZnPgo=) no-repeat",
            width: "20px",
            height: "20px",
            display: "inline-block",
        }}/></td>
    </tr>
    </tbody>
</table>

This guide walks you through setting up Application Performance Monitoring (APM) on a Node.js application. These instructions can also be found on the Installation page in your Middleware Account. View <a href="https://github.com/middleware-labs/demo-apm/tree/master/nodejs"> demo project here </a>.

## Prerequisites
* Middleware Host Agent (MW Agent), to install the MW Agent please see our <a href="https://docs.middleware.io/docs/agent-installation/overview"> installation guide </a>. 
* Node.js version 12.13.0 or above. Check your Node.js version with the following command. 
```
node --version
```
--------------------

## Step 1: Install NPM Package
Run the following command in your terminal. 

```javascript
npm install @middleware.io/node-apm --save
```

## Step 2:  Initialize Tracker
Add the following lines to the beginning of your application code base. The access token is your account key, which can be found on the Installation page.

```javascript
const tracker = require('@middleware.io/node-apm');
tracker.track({
    projectName: "your-project-name",
    serviceName: "your-service-name",
    accessToken: “<xxxxxxxxxx>”;
});
```

## Step 3: Container Variables
Applications running in a container require an additional environment variable. If your application is not running in a container, move to Step 4. 

For Docker containers, add the following environment variable to your application.
```bash
MW_AGENT_SERVICE=<DOCKER_BRIDGE_GATEWAY_ADDRESS>
```
<Note> docker bridge gateway address is the IP address of the gateway between the Docker host and the bridge network, which is 172.17.0.1 by default. 
Refer more about Docker bridge networking [here](https://docs.docker.com/network/network-tutorial-standalone/) </Note>

```bash
kubectl get service --all-namespaces | grep mw-service
```

Then add the following environment variable to your application deployment YAML file. 
```bash
MW_AGENT_SERVICE=mw-service.mw-agent-ns.svc.cluster.local
```

## Step 4: Capture Application Data

### Traces
Distributed tracing is automatically enabled upon completion of Step 2.

### Custom Logs
To ingest custom logs into Middleware, utilize the following functions inside your logging method based on desired log severity levels.
```javascript
tracker.info('Info sample');
tracker.warn('Warning sample');
tracker.debug('Debugging Sample');
tracker.error('Error Sample');
```

To add stack traces along with the error log, use the following error tracking function.
```javascript
tracker.error(new Error('Error sample with stack trace'));
```

### Profiling
Application Profiling is auto-configured upon completing Step 2.

### Stack Traces 
Use the errorRecord method to record a stack trace when an error occurs. See an example of this method below. 
```javascript
 app.get('/error', function (req, res) {
    try{
        throw new Error('oh error!');
    }catch (e) {
       track.errorRecord(e)
    }
    res.status(500).send("wrong");
}); 

```


